.. index::
    single: Customization; RoutingAutoBundle

Defunct Route Handlers
----------------------

.. _routingauto_customization_defunctroutehandlers:

When an already-persisted document is updated and the URI generated by the
RoutingAuto system is changed, a *new* route is always created. Defunct route
handlers decide what to do with the *old* routes.

remove
~~~~~~

The remove handler will simply delete any old routes. This is the **default**
action.

.. configuration-block::

    .. code-block:: yaml

        stdClass:
            uri_schema: /cmf/blog
            defunct_route_handler: remove

    .. code-block:: xml

        <auto-mapping xmlns="http://cmf.symfony.com/schema/routing_auto">
            <mapping class="stdClass" uri-schema="/cmf/blog">
                <defunct-route-handler name="remove" />
            </mapping>
        </auto-mapping>

.. note::

    The above example is illustrative only. Removing old routes is the default
    action, so it is not necessary to explicitly configure this handler.

leave_redirect
~~~~~~~~~~~~~~

The ``LeaveRedirectDefunctRouteHandler`` will automatically update old routes
to redirect the browser to the route which has replaced it. This effectively
means you can rename your objects without worrying about users receiving HTTP
404 responses.

The handler will replace the old route with a ``RedirectRoute`` at the same
path.

.. configuration-block::

    .. code-block:: yaml

        stdClass:
            uri_schema: /cmf/blog
            defunct_route_handler: leave_redirect

    .. code-block:: xml

        <auto-mapping xmlns="http://cmf.symfony.com/schema/routing_auto">
            <mapping class="stdClass" uri-schema="/cmf/blog">
                <defunct-route-handler name="leave_redirect" />
            </mapping>
        </auto-mapping>

For the redirect to work you will also need to configure a redirect controller
in the ``cmf_routing`` configuration::

.. configuration-block::

    .. code-block:: yaml

        cmf_routing:
            dynamic:
                controllers_by_class:
                    Symfony\Cmf\Bundle\RoutingBundle\Doctrine\Phpcr\RedirectRoute: cmf_routing.redirect_controller:redirectAction

    .. code-block:: xml

        <?xml version="1.0" encoding="UTF-8" ?>
        <container xmlns="http://symfony.com/schema/dic/services">

            <config xmlns="http://cmf.symfony.com/schema/dic/routing">
                <dynamic>
                    <controller-by-class
                        class="Symfony\Cmf\Bundle\RoutingBundle\Doctrine\Phpcr\RedirectRoute">
                        cmf_routing.redirect_controller:redirectAction
                    </controller-by-class>
                </dynamic>
            </config>

        </container>

    .. code-block:: php

        $container->loadFromExtension('cmf_routing', array(
            'dynamic' => array(
                'controllers_by_class' => array(
                    'Symfony\Cmf\Bundle\RoutingBundle\Doctrine\Phpcr\RedirectRoute' => 'cmf_routing.redirect_controller:redirectAction',
                ),
            ),
        ));
